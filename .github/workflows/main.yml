name: RDP Windows 11 Premium Ultimate
on:
  workflow_dispatch:

jobs:
  secure-rdp:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:

      # ============================
      # 1. ENABLE RDP & CREATE USER
      # ============================
      - name: Enable RDP + Create User ducthenggaming
        run: |
          Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          net user ducthenggaming "123456" /add
          net localgroup administrators ducthenggaming /add
          reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PasswordLess\Device" /v DevicePasswordLessBuildVersion /t REG_DWORD /d 0 /f

      # ============================
      # 2. SHOW VPS INFO
      # ============================
      - name: Show RDP Login Info
        run: |
          $ip = (Invoke-WebRequest -Uri "https://api.ipify.org").Content
          Write-Host "========================="
          Write-Host "   RDP READY - PREMIUM"
          Write-Host "IP: $ip"
          Write-Host "User: ducthenggaming"
          Write-Host "Pass: 123456"
          Write-Host "========================="

      # ============================
      # 3. AUTO INSTALL APPLICATIONS
      # ============================
      - name: Install OBS + TikTok Live + Steam + Google Drive + Roblox
        run: |
          Invoke-WebRequest "https://cdn-fastly.obsproject.com/downloads/OBS-Studio-30.2.3-Full-Installer-x64.exe" -OutFile obs.exe
          Start-Process obs.exe -ArgumentList "/S" -Wait

          Invoke-WebRequest "https://sf16-file-upload-tos.pstatp.com/obj/tiktok-live/LiveStudioSetup.exe" -OutFile tiktok.exe
          Start-Process tiktok.exe -ArgumentList "/S" -Wait
          
          Invoke-WebRequest "https://steamcdn-a.akamaihd.net/client/installer/SteamSetup.exe" -OutFile steam.exe
          Start-Process steam.exe -ArgumentList "/S" -Wait

          Invoke-WebRequest "https://dl.google.com/drive-file-stream/GoogleDriveSetup.exe" -OutFile drive.exe
          Start-Process drive.exe -ArgumentList "/silent" -Wait

          Invoke-WebRequest "https://setup.rbxcdn.com/Roblox.exe" -OutFile roblox.exe
          Start-Process roblox.exe -Wait

      # ============================
      # 4. AUTO CLEAN WINDOWS BLOATWARE
      # ============================
      - name: Remove Bloatware & Clean Windows
        run: |
          Get-AppxPackage *xbox* | Remove-AppxPackage
          Get-AppxPackage *bing* | Remove-AppxPackage
          Get-AppxPackage *teams* | Remove-AppxPackage
          Get-AppxPackage *skype* | Remove-AppxPackage
          Get-AppxPackage *feedback* | Remove-AppxPackage
          Get-AppxPackage *solitaire* | Remove-AppxPackage
          Get-AppxPackage *weather* | Remove-AppxPackage
          Get-AppxPackage *getstarted* | Remove-AppxPackage
          Get-AppxPackage *people* | Remove-AppxPackage

      # ============================
      # 5. WINDOWS 11 ULTRA OPTIMIZATION
      # ============================
      - name: Optimize Windows for FPS + Ping + Music
        run: |
          # Disable lag services
          Stop-Service SysMain -Force
          Set-Service SysMain -StartupType Disabled
          Stop-Service DiagTrack -Force
          Set-Service DiagTrack -StartupType Disabled

          # CPU/GPU Boost
          powercfg -setacvalueindex SCHEME_CURRENT SUB_PROCESSOR PROCTHROTTLEMIN 100
          powercfg -setacvalueindex SCHEME_CURRENT SUB_PROCESSOR PROCTHROTTLEMAX 100
          powercfg -setactive SCHEME_CURRENT

          # Low latency internet
          netsh int tcp set global autotuninglevel=normal
          netsh int tcp set global rss=enabled
          netsh int tcp set supplemental template=internet
          netsh int tcp set global ecncapability=enabled

          # Reduce packet loss (mạng yếu vẫn mượt)
          reg add "HKLM\SYSTEM\CurrentControlSet\Services\Ndu" /v Start /t REG_DWORD /d 4 /f

          # Boost audio playback
          reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Audio" /v PerformanceMode /t REG_DWORD /d 1 /f
          reg add "HKCU\Software\Microsoft\Multimedia\Audio" /v UserDuckingPreference /t REG_DWORD /d 3 /f

          # Gaming network priority
          reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" /v NetworkThrottlingIndex /t REG_DWORD /d 4294967295 /f
          reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" /v SystemResponsiveness /t REG_DWORD /d 0 /f

          # Roblox lag fix
          reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v MaxConnectionsPerServer /t REG_DWORD /d 10 /f

      # ============================
      # 6. AUTO GPU BOOST (OBS + TIKTOK LIVE)
      # ============================
      - name: GPU Boost for Streaming Apps
        run: |
          reg add "HKLM\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" /v HwSchMode /t REG_DWORD /d 2 /f
          reg add "HKCU\Software\Microsoft\DirectX\UserGpuPreferences" /v "obs64.exe" /t REG_SZ /d "GpuPreference=2;" /f
          reg add "HKCU\Software\Microsoft\DirectX\UserGpuPreferences" /v "LiveStudio.exe" /t REG_SZ /d "GpuPreference=2;" /f

      # ============================
      # 7. APPLY WALLPAPER (CENTER)
      # ============================
      - name: Apply Gojo Wallpaper (Center)
        run: |
          Invoke-WebRequest "https://huggingface.co/HieuDepTry-Gojo/resolve/main/gojo.png" -OutFile C:\gojo.png
          reg add "HKCU\Control Panel\Desktop" /v Wallpaper /t REG_SZ /d "C:\gojo.png" /f
          reg add "HKCU\Control Panel\Desktop" /v WallpaperStyle /t REG_SZ /d 0 /f
          reg add "HKCU\Control Panel\Desktop" /v TileWallpaper /t REG_SZ /d 0 /f
          RUNDLL32.EXE USER32.DLL,UpdatePerUserSystemParameters

      # ============================
      # 8. KEEP VPS ALIVE
      # ============================
      - name: Keep VPS Alive 6 Hours
        run: |
          for ($i=1; $i -le 360; $i++) {
            Write-Host "RDP Active... phút: $i"
            Start-Sleep -Seconds 60
          }
