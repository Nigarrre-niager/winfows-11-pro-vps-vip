name: ğŸš€ SERVER DucThengGaming

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '1_Giá»_30_PhÃºt_(90m)'
        type: choice
        options:
          - '30_PhÃºt_(30m)'
          - '1_Giá»_(60m)'
          - '1_Giá»_30_PhÃºt_(90m)'
          - '2_Giá»_(120m)'
          - '2_Giá»_30_PhÃºt_(150m)'
          - '3_Giá»_(180m)'
          - '3_Giá»_30_PhÃºt_(210m)'
          - '4_Giá»_(240m)'
          - '4_Giá»_30_PhÃºt_(270m)'
          - '5_Giá»_(300m)'
          - '5_Giá»_30_PhÃºt_(330m)'
          - '6_Giá»_(360m)'
          - '30_NgÃ y_(43200m)'
          - '60_NgÃ y_(86400m)'
          - '90_NgÃ y_(129600m)'

jobs:
  DucThengGaming-RDP-Setup:
    runs-on: windows-latest
    steps:

      # BANNER KHá»I Äá»˜NG
      - name: KHá»I Äá»˜NG
        shell: powershell
        run: |
          Write-Host "ğŸš€ Chuáº©n bá»‹ táº¡o tÃ i khoáº£n RDP DucThengGaming..." -ForegroundColor Green

      # Cáº¤U HÃŒNH RDP
      - name: Cáº¤U HÃŒNH RDP
        shell: powershell
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
          netsh advfirewall firewall add rule name="RDP-DucTheng" dir=in action=allow protocol=TCP localport=3389
          Set-Service -Name TermService -StartupType Automatic
          Start-Service TermService

      # Táº O USER DucThengGaming
      - name: Táº O USER DucThengGaming
        shell: powershell
        run: |
          $upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ'
          $lower = 'abcdefghijkmnpqrstuvwxyz'
          $numbers = '23456789'
          $all = $upper + $lower + $numbers
          $pw = ''
          $pw += $upper[(Get-Random -Minimum 0 -Maximum $upper.Length)]
          $pw += $lower[(Get-Random -Minimum 0 -Maximum $lower.Length)]
          $pw += $numbers[(Get-Random -Minimum 0 -Maximum $numbers.Length)]
          for ($i=1; $i -le 5; $i++) { $pw += $all[(Get-Random -Minimum 0 -Maximum $all.Length)] }
          $password = -join ($pw.ToCharArray() | Sort-Object { Get-Random })
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          try { Remove-LocalUser -Name "DucThengGaming" -ErrorAction SilentlyContinue } catch {}
          New-LocalUser -Name "DucThengGaming" -Password $securePass -AccountNeverExpires
          Add-LocalGroupMember -Group "Administrators" -Member "DucThengGaming"
          Add-LocalGroupMember -Group "Remote Desktop Users" -Member "DucThengGaming"
          Enable-LocalUser -Name "DucThengGaming"
          echo "RDP_USER=DucThengGaming" >> $env:GITHUB_ENV
          echo "RDP_PASS=$password" >> $env:GITHUB_ENV
          Write-Host "âœ… TÃ i khoáº£n DucThengGaming Ä‘Ã£ sáºµn sÃ ng. Máº­t kháº©u: $password" -ForegroundColor Green

      # HÃŒNH Ná»€N GOJO
      - name: SET WALLPAPER GOJO
        shell: powershell
        run: |
          $url = "https://i.imgur.com/YOUR_GOJO_IMAGE.png"
          $wallpaper = "$env:TEMP\gojo.png"
          Invoke-WebRequest -Uri $url -OutFile $wallpaper
          Add-Type -TypeDefinition @"
          using System.Runtime.InteropServices;
          public class Wallpaper {
              [DllImport("user32.dll", SetLastError = true)]
              public static extern bool SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
          }
"@
          [Wallpaper]::SystemParametersInfo(20, 0, $wallpaper, 3)
          Write-Host "âœ… HÃ¬nh ná»n Gojo Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t!"

      # THIáº¾T Láº¬P TAILSCALE
      - name: TAILSCALE CONNECTION
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        shell: powershell
        run: |
          $msiPath = "$env:TEMP\tailscale.msi"
          Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
          Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
          Remove-Item $msiPath -Force
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=DucThengGaming-$env:GITHUB_RUN_ID
          $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
          echo "TAILSCALE_IP=$tsIP" >> $env:GITHUB_ENV
          Write-Host "âœ… Tailscale IP: $tsIP"

      # KIá»‚M TRA RDP
      - name: KIá»‚M TRA RDP
        shell: powershell
        run: |
          Write-Host "Äá»‹a chá»‰ Tailscale: $env:TAILSCALE_IP"
          $testResult = Test-NetConnection -ComputerName $env:TAILSCALE_IP -Port 3389 -WarningAction SilentlyContinue
          if (-not $testResult.TcpTestSucceeded) {
              Write-Error "KhÃ´ng thá»ƒ káº¿t ná»‘i TCP Ä‘áº¿n RDP"
              exit 1
          }
          Write-Host "âœ… Káº¿t ná»‘i RDP thÃ nh cÃ´ng"

      # DUY TRÃŒ PHIÃŠN LÃ€M VIá»†C
      - name: DUY TRÃŒ PHIÃŠN
        shell: powershell
        run: |
          Write-Host "ğŸ•’ PhiÃªn RDP Ä‘ang cháº¡y. Ctrl+C Ä‘á»ƒ dá»«ng workflow."
          while ($true) { Start-Sleep -Seconds 300 }
